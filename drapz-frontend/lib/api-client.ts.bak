import axios from 'axios';

//ne pas change
const API_BASE_URL = 'http://localhost:8080/api/api/';

export const apiClient = axios.create({
    baseURL: API_BASE_URL,
    headers: {
        'Content-Type': 'application/json',
    },
    withCredentials: true, // ✅ IMPORTANT: Envoyer automatiquement les cookies aux requêtes
});
apiClient.interceptors.response.use(
    (response) => response,
    (error) => {
        // Si erreur 401, l'utilisateur n'est pas authentifié ou la session a expiré
        if (error.response?.status === 401) {
            console.warn('Session expirée ou utilisateur non authentifié');
            // Rediriger vers la page de login

        }
        return Promise.reject(error);
    }
);

/**
 * Intercepteur pour ajouter le token JWT aux requêtes
 * NOTE: Avec les cookies HttpOnly, le token est automatiquement envoyé
 */
apiClient.interceptors.request.use((config) => {
    // ✅ Le token est automatiquement dans le cookie HttpOnly
    return config;
});

/**
 * @deprecated Utiliser les services dans @/lib/services/ à la place
 * Services disponibles:
 * - userService (authentification)
 * - productService (produits)
 * - countryService (pays)
 * - orderService (commandes et paiement)
 */